<!doctype html>
<html lang="ru">

<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shop ‚Äî WebApp</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f5f6f7; --card:#ffffff; --muted:#8b8f94; --accent:#f6bb42;
  --radius:20px; --shadow:0 6px 18px rgba(17,24,39,0.08);
}
*{box-sizing:border-box}
html,body{
  margin:0; padding:0; height:100%;
  font-family:Inter,system-ui; background:var(--bg);
}

/* Layout */
.container{max-width:1100px;margin:24px auto;padding:16px;}
.header{display:flex;align-items:center;gap:12px;}
.header h1{margin:0;font-size:32px}

/* Grid */
.grid{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:18px;margin-top:18px;
}
.card{
  background:var(--card);border-radius:18px;box-shadow:var(--shadow);
  padding:14px;cursor:pointer;
}
.card .img{
  height:180px;background:#f3f4f6;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
}
.card img{max-width:100%;max-height:100%;object-fit:contain}
.price{font-weight:700;font-size:20px;margin:12px 0;}
.title{color:var(--muted);font-size:15px}

/* Categories */
.filter-row{display:flex;gap:10px;align-items:center;margin-top:18px;flex-wrap:wrap}
.category{
  padding:8px 12px;border-radius:12px;background:#fff;border:1px solid #eee;cursor:pointer;
}
.category.active{
  border-color:var(--accent);box-shadow:0 4px 12px rgba(246,187,66,0.2)
}

/* Modal */
.modal-back{
  position:fixed;inset:0;background:rgba(0,0,0,0.45);
  display:none;align-items:flex-end;justify-content:center;
}
.modal{
  width:100%;max-width:720px;background:var(--card);
  border-radius:20px 20px 0 0;padding:18px;
}
.large-img{
  height:320px;background:#f3f4f6;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
}
.row{display:flex;gap:10px;align-items:center}
.chips{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.chip{
  padding:10px 14px;border-radius:14px;border:1px solid #e6e6e9;cursor:pointer;
}
.chip.active{border-color:var(--accent);background:#fff4d0}

.add-btn{
  width:100%;padding:14px;border-radius:14px;
  background:var(--accent);border:none;color:#fff;
  font-weight:700;font-size:16px;cursor:pointer;margin-top:12px;
}

/* Bottom Nav */
.bottom-nav{
  position:fixed;left:50%;transform:translateX(-50%);
  bottom:12px;display:flex;gap:12px;
}
.nav-btn{
  width:72px;height:56px;border-radius:14px;
  background:var(--card);box-shadow:var(--shadow);
  display:flex;align-items:center;justify-content:center;
}
.nav-active{background:var(--accent);color:#fff}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <div style="font-size:30px">üî•</div>
    <h1>–ù–æ–≤—ã–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</h1>
  </div>

  <div class="filter-row" id="categories"></div>
  <div class="grid" id="productGrid"></div>
</div>

<div class="bottom-nav">
  <div class="nav-btn nav-active">üè†</div>
  <div class="nav-btn">üîç</div>
  <div class="nav-btn">‚ñ¶</div>
  <div class="nav-btn">üëú</div>
</div>

<!-- Modal -->
<div class="modal-back" id="modalBack">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800;font-size:20px" id="mTitle"></div>
      <button id="closeModal" class="chip">‚úñ</button>
    </div>

    <div class="large-img" id="mImg"></div>
    <div style="margin-top:12px;font-weight:700;font-size:20px" id="mPrice"></div>

    <div style="color:var(--muted);margin-top:10px">–¶–≤–µ—Ç</div>
    <div class="chips" id="mColors"></div>

    <div style="color:var(--muted);margin-top:12px">–†–∞–∑–º–µ—Ä</div>
    <div class="chips" id="mSizes"></div>

    <button id="addToBot" class="add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
</div>

<script>
// ===============================
// PRODUCT DATA
// ===============================
const products = [
  {id:1, code:90, title:'–ö–ª–µ—Ç—á–∞—Ç–∞—è —Ä—É–±–∞—à–∫–∞', price:200000, img:'https://images.unsplash.com/photo-1551854838-8c9f3db3b3b1', category:'–†—É–±–∞—à–∫–∏', colors:['Blue','Light blue'], sizes:['L','XL','XXL']},
  {id:2, code:101, title:'–•—É–¥–∏',              price:350000, img:'https://images.unsplash.com/photo-1541099649105-f69ad21f3246', category:'–•—É–¥–∏', colors:['Black'], sizes:['M','L','XL']},
  {id:3, code:102, title:'–®—Ç–∞–Ω—ã',             price:350000, img:'https://images.unsplash.com/photo-1541099649105-f69ad21f3246', category:'–®—Ç–∞–Ω—ã', colors:['Black','Grey'], sizes:['M','L','XL']},
  {id:4, code:103, title:'–ö–µ–ø–∫–∞',             price:150000, img:'https://images.unsplash.com/photo-1520975698514-3094b1d6e3d7', category:'–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã', colors:['Red','Beige'], sizes:['One size']}
];

const categories = ['–í—Å–µ','–•—É–¥–∏','–†—É–±–∞—à–∫–∏','–®—Ç–∞–Ω—ã','–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã'];
let activeCategory = '–í—Å–µ';

const productGrid = document.getElementById('productGrid');
const categoriesWrap = document.getElementById('categories');

let currentProduct = null;
let selectedColor = null;
let selectedSize = null;

// ===============================
// CATEGORY RENDER
// ===============================
function renderCategories(){
  categoriesWrap.innerHTML = '';
  categories.forEach(cat=>{
    const el = document.createElement('div');
    el.className = 'category' + (cat===activeCategory ? ' active' : '');
    el.textContent = cat;
    el.onclick = () => {
      activeCategory = cat;
      renderCategories();
      renderProducts();
    };
    categoriesWrap.appendChild(el);
  });
}

// ===============================
// PRODUCT GRID
// ===============================
function renderProducts(){
  productGrid.innerHTML = '';
  const list = products.filter(p => activeCategory==='–í—Å–µ' || p.category===activeCategory);

  list.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'card';

    card.onclick = () => openModal(p.id);

    card.innerHTML = `
      <div class="img"><img src="${p.img}" alt=""></div>
      <div class="price">${p.price.toLocaleString('ru-RU')} UZS</div>
      <div class="title">${p.title}</div>
    `;
    productGrid.appendChild(card);
  });
}

// ===============================
// MODAL
// ===============================
const modalBack = document.getElementById('modalBack');
const mTitle = document.getElementById('mTitle');
const mImg = document.getElementById('mImg');
const mPrice = document.getElementById('mPrice');
const mColors = document.getElementById('mColors');
const mSizes = document.getElementById('mSizes');
const addToBot = document.getElementById('addToBot');

function openModal(id){
  currentProduct = products.find(p=>p.id===id);
  selectedColor = null;
  selectedSize = null;

  mTitle.textContent = currentProduct.title;
  mImg.innerHTML = `<img src="${currentProduct.img}" style="max-width:100%;max-height:100%">`;
  mPrice.textContent = currentProduct.price.toLocaleString('ru-RU') + " UZS";

  // Colors
  mColors.innerHTML = '';
  currentProduct.colors.forEach(c=>{
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.textContent = c;
    chip.onclick = () => {
      selectedColor = c;
      [...mColors.children].forEach(x=>x.classList.remove('active'));
      chip.classList.add('active');
    };
    mColors.appendChild(chip);
  });

  // Sizes
  mSizes.innerHTML = '';
  currentProduct.sizes.forEach(s=>{
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.textContent = s;
    chip.onclick = () => {
      selectedSize = s;
      [...mSizes.children].forEach(x=>x.classList.remove('active'));
      chip.classList.add('active');
    };
    mSizes.appendChild(chip);
  });

  modalBack.style.display = 'flex';
}

document.getElementById('closeModal').onclick = () => {
  modalBack.style.display = 'none';
};
modalBack.onclick = (e)=>{
  if(e.target === modalBack){
    modalBack.style.display = 'none';
  }
};

// ===============================
// TELEGRAM WEBAPP SEND DATA
// ===============================
const isTelegram = window.Telegram?.WebApp;

if(isTelegram){
  window.Telegram.WebApp.ready();
}

addToBot.onclick = ()=>{
  if(!currentProduct) return;

  const payload = {
    action: 'add',
    productId: currentProduct.id,
    code: currentProduct.code,
    color: selectedColor,
    size: selectedSize
  };

  if(isTelegram){
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  }else{
    alert("WebApp —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Telegram.\n–û—Ç–ø—Ä–∞–≤–∫–∞:"+JSON.stringify(payload));
  }
};

// ===============================
renderCategories();
renderProducts();
</script>
</body>
</html>
